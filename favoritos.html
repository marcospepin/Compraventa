<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mis Favoritos - MCR Motors</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" href="img/favicon.ico" type="image/x-icon">
</head>
<body>
  <header class="sticky-top">
    <div class="top-bar bg-dark text-white py-2">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6">
            <div class="contact-info">
              <a href="https://wa.me/34617700519" target="_blank" class="text-white text-decoration-none me-3"><i class="fas fa-phone-alt me-2"></i>617700519</a>
              <a href="https://maps.app.goo.gl/1sFr4C8WtWS3zJPV6" target="_blank" class="text-white text-decoration-none"><i class="fas fa-map-marker-alt me-2"></i>San Ciprián De Viñas, Galicia</a>
            </div>
          </div>
          <div class="col-md-6 text-md-end">
            <div class="social-links">
              <a href="https://www.instagram.com/marcos_pepin/" target="_blank" class="text-white me-3"><i class="fab fa-instagram"></i></a>
              <a href="https://es.wallapop.com/user/pepinairlines-354840890" target="_blank" class="text-white me-3"><i class="fas fa-store"></i></a>
              <a href="https://www.coches.net/concesionario/grmmotorsport/" target="_blank" class="text-white"><i class="fas fa-car"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <nav class="navbar navbar-expand-lg navbar-light">
      <div class="container">
        <a class="navbar-brand" href="index.html">
          <img src="images/logo-ppal.png" alt="MCR Motors Logo" height="60">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Inicio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="coches-venta.html">Coches en Venta</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="coches-vendidos.html">Coches Vendidos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="financiacion.html">Financiación</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="contacto.html">Contacto</a>
            </li>
          </ul>
          <div class="ms-lg-3 mt-3 mt-lg-0" id="auth-buttons">
            <a href="login.html" class="btn btn-outline-primary me-2"><i class="fas fa-sign-in-alt me-1"></i>Iniciar Sesión</a>
            <a href="registro.html" class="btn btn-primary"><i class="fas fa-user-plus me-1"></i>Registrarse</a>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <main>
    <section class="page-header bg-dark text-white py-5">
      <div class="container">
        <div class="row">
          <div class="col-12 text-center">
            <h1><i class="fas fa-heart me-2"></i>Mis Favoritos</h1>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb justify-content-center">
                <li class="breadcrumb-item"><a href="index.html" class="text-white">Inicio</a></li>
                <li class="breadcrumb-item active text-white" aria-current="page">Favoritos</li>
              </ol>
            </nav>
          </div>
        </div>
      </div>
    </section>

    <section class="favorites-section py-5">
      <div class="container">
        <div class="row mb-4">
          <div class="col-12">
            <h2>Vehículos Guardados</h2>
            <p class="text-muted" id="favorites-count">Cargando...</p>
          </div>
        </div>
        
        <div class="row g-4" id="favorites-container">
          <!-- Los favoritos se cargarán dinámicamente aquí -->
        </div>
      </div>
    </section>
  </main>

  <!-- Modal de Detalles del Vehículo -->
  <div class="modal fade" id="vehicleModal" tabindex="-1" aria-labelledby="vehicleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="vehicleModalLabel"><i class="fas fa-car me-2"></i>Detalles del Vehículo</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <!-- Galería de Imágenes -->
            <div class="col-lg-7 mb-4 mb-lg-0">
              <div id="vehicleCarousel" class="carousel slide mb-3" data-bs-ride="false">
                <div class="carousel-indicators" id="carousel-indicators">
                  <!-- Indicadores dinámicos -->
                </div>
                <div class="carousel-inner" id="carousel-inner">
                  <!-- Imágenes dinámicas -->
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#vehicleCarousel" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Anterior</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#vehicleCarousel" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Siguiente</span>
                </button>
              </div>
              
              <!-- Botones de acción debajo de las imágenes -->
              <div class="d-grid gap-2">
                <button class="btn btn-primary btn-lg" id="modal-btn-favorito">
                  <i class="far fa-heart me-2"></i>Añadir a Favoritos
                </button>
                <a href="contacto.html" class="btn btn-outline-primary btn-lg">
                  <i class="fas fa-phone-alt me-2"></i>Contactar Vendedor
                </a>
              </div>
            </div>
            
            <!-- Información del Vehículo -->
            <div class="col-lg-5">
              <div class="vehicle-details">
                <h3 id="modal-vehicle-name" class="mb-2"></h3>
                <h2 id="modal-vehicle-price" class="mb-4"></h2>
                
                <div class="vehicle-specs">
                  <div class="row g-3">
                    <div class="col-6">
                      <div class="spec-item p-3 text-center">
                        <i class="fas fa-calendar text-primary"></i>
                        <strong>Año</strong>
                        <div id="modal-vehicle-year"></div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="spec-item p-3 text-center">
                        <i class="fas fa-tachometer-alt text-primary"></i>
                        <strong>Kilómetros</strong>
                        <div id="modal-vehicle-km"></div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="spec-item p-3 text-center">
                        <i class="fas fa-gas-pump text-primary"></i>
                        <strong>Combustible</strong>
                        <div id="modal-vehicle-fuel"></div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="spec-item p-3 text-center">
                        <i class="fas fa-cog text-primary"></i>
                        <strong>Transmisión</strong>
                        <div id="modal-vehicle-transmission"></div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="spec-item p-3 text-center">
                        <i class="fas fa-tachometer-alt text-primary"></i>
                        <strong>Potencia</strong>
                        <div id="modal-vehicle-potencia"></div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="spec-item p-3 text-center">
                        <i class="fas fa-check-circle text-primary"></i>
                        <strong>Estado</strong>
                        <div id="modal-vehicle-status"></div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="vehicle-description">
                  <h5><i class="fas fa-info-circle me-2"></i>Descripción</h5>
                  <p id="modal-vehicle-description"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer bg-dark text-white py-5 mt-5">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 mb-4">
          <img src="images/logo-ppal.png" alt="MCR Motors Logo" height="60" class="mb-3">
          <p>Tu concesionario de confianza especializado en vehículos premium y de alta gama.</p>
        </div>
        <div class="col-lg-4 mb-4">
          <h5>Contacto</h5>
          <ul class="list-unstyled">
            <li><i class="fas fa-phone-alt me-2"></i>617700519</li>
            <li><a href="https://maps.app.goo.gl/1sFr4C8WtWS3zJPV6" target="_blank" class="text-white text-decoration-none"><i class="fas fa-map-marker-alt me-2"></i>San Ciprián De Viñas, Galicia</a></li>
          </ul>
        </div>
        <div class="col-lg-4 mb-4">
          <h5>Síguenos</h5>
          <div class="social-links">
            <a href="https://www.instagram.com/marcos_pepin/" target="_blank" class="text-white me-3 fs-4"><i class="fab fa-instagram"></i></a>
            <a href="https://es.wallapop.com/user/pepinairlines-354840890" target="_blank" class="text-white me-3 fs-4"><i class="fas fa-store"></i></a>
            <a href="https://www.coches.net/concesionario/grmmotorsport/" target="_blank" class="text-white fs-4"><i class="fas fa-car"></i></a>
          </div>
        </div>
      </div>
      <hr class="my-4 bg-white">
      <div class="row">
        <div class="col-12 text-center">
          <p class="mb-0">&copy; 2025 MCR Motors. Todos los derechos reservados.</p>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/script.js"></script>
  <script>
    let currentUser = null;

    // Verificar sesión
    async function checkSession() {
      try {
        const response = await fetch('php/auth.php?action=check_session');
        const data = await response.json();
        
        if (!data.authenticated) {
          window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.pathname);
          return;
        }
        
        currentUser = data.user;
        loadFavorites();
      } catch (error) {
        console.error('Error:', error);
        window.location.href = 'login.html';
      }
    }

    // Cargar favoritos
    async function loadFavorites() {
      const container = document.getElementById('favorites-container');
      const countElement = document.getElementById('favorites-count');
      
      container.innerHTML = '<div class="col-12 text-center"><div class="spinner-border text-primary" role="status"></div></div>';
      
      try {
        const response = await fetch('php/favoritos.php?action=list');
        const data = await response.json();
        
        if (data.success) {
          const favorites = data.favoritos;
          
          if (favorites.length === 0) {
            container.innerHTML = `
              <div class="col-12 text-center py-5">
                <i class="fas fa-heart-broken fa-4x text-muted mb-3"></i>
                <h3>No tienes favoritos aún</h3>
                <p class="text-muted">Explora nuestro catálogo y guarda tus vehículos favoritos</p>
                <a href="coches-venta.html" class="btn btn-primary mt-3">Ver Catálogo</a>
              </div>
            `;
            countElement.textContent = 'No hay favoritos guardados';
            return;
          }
          
          countElement.textContent = `${favorites.length} vehículo${favorites.length !== 1 ? 's' : ''} guardado${favorites.length !== 1 ? 's' : ''}`;
          renderFavorites(favorites);
        }
      } catch (error) {
        console.error('Error:', error);
        container.innerHTML = '<div class="col-12 text-center py-5"><p class="text-danger">Error al cargar favoritos</p></div>';
      }
    }

    // Renderizar favoritos
    function renderFavorites(favorites) {
      const container = document.getElementById('favorites-container');
      container.innerHTML = '';
      
      favorites.forEach(vehicle => {
        const card = createFavoriteCard(vehicle);
        container.innerHTML += card;
      });
      
      // Agregar event listeners
      document.querySelectorAll('.btn-remove-favorite').forEach(btn => {
        btn.addEventListener('click', removeFavorite);
      });
    }

    // Crear tarjeta de favorito
    function createFavoriteCard(vehicle) {
      const imageUrl = vehicle.imagen_url || 'https://via.placeholder.com/800x500?text=Sin+Imagen';
      const precio = parseFloat(vehicle.precio).toLocaleString('es-ES', { minimumFractionDigits: 2 });
      const kilometraje = vehicle.kilometraje ? parseInt(vehicle.kilometraje).toLocaleString('es-ES') : 'N/D';
      
      return `
        <div class="col-md-6 col-lg-4">
          <div class="card car-card h-100">
            <div class="car-image-wrapper position-relative">
              <img src="${imageUrl}" class="card-img-top" alt="${vehicle.marca} ${vehicle.modelo}" onerror="this.src='https://via.placeholder.com/800x500?text=Sin+Imagen'">
              <span class="car-price">${precio} €</span>
              <button class="btn btn-favorito btn-remove-favorite" data-vehicle-id="${vehicle.id}" title="Quitar de favoritos">
                <i class="fas fa-heart"></i>
              </button>
            </div>
            <div class="card-body">
              <h5 class="card-title">${vehicle.marca} ${vehicle.modelo}</h5>
              <p class="card-text text-muted">${vehicle.anio} | ${kilometraje} km | ${vehicle.combustible}</p>
              <p class="text-muted small"><i class="fas fa-calendar-plus me-2"></i>Guardado: ${new Date(vehicle.fecha_agregado).toLocaleDateString('es-ES')}</p>
            </div>
            <div class="card-footer bg-white border-top-0">
              <div class="d-flex justify-content-between">
                <a href="coches-venta.html?vehiculo=${vehicle.id}" class="btn btn-outline-primary btn-sm">Ver Detalles</a>
                <a href="contacto.html" class="btn btn-primary btn-sm">Contactar</a>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Eliminar favorito
    async function removeFavorite(e) {
      e.preventDefault();
      const btn = e.currentTarget;
      const vehicleId = btn.dataset.vehicleId;
      
      if (!confirm('¿Quitar este vehículo de favoritos?')) return;
      
      try {
        const response = await fetch('php/favoritos.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'remove', vehiculo_id: vehicleId })
        });
        
        const data = await response.json();
        
        if (data.success) {
          loadFavorites();
        }
      } catch (error) {
        console.error('Error:', error);
      }
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', checkSession);
  </script>
  <script src="js/vehiculos.js"></script>
</body>
</html>
